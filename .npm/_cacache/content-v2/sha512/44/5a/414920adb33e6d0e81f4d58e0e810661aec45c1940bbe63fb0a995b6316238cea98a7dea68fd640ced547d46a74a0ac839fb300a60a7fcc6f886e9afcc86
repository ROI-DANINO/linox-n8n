{"_id":"@n8n/vm2","_rev":"11-cf47ba24155757cdc04c34eb875c6507","name":"@n8n/vm2","dist-tags":{"latest":"3.9.25"},"versions":{"3.9.19":{"name":"@n8n/vm2","version":"3.9.19","keywords":["sandbox","prison","jail","vm","alcatraz","contextify"],"license":"MIT","_id":"@n8n/vm2@3.9.19","maintainers":[{"name":"ivov.src","email":"ivov.src@gmail.com"},{"name":"milorad.filipovic","email":"milorad.filipovic19@gmail.com"},{"name":"netroy","email":"npm@netroy.in"},{"name":"jan_n8n_io","email":"jan@n8n.io"}],"homepage":"https://github.com/n8n-io/vm2#readme","bugs":{"url":"https://github.com/n8n-io/vm2/issues"},"bin":{"vm2":"bin/vm2"},"dist":{"shasum":"e63dc6986f8f14f06600826658a59bc1a703707c","tarball":"https://registry.npmjs.org/@n8n/vm2/-/vm2-3.9.19.tgz","fileCount":24,"integrity":"sha512-KmrkVqri7VG+GQ2JbJ2/2gyEmVkysxzoJUF+zdtqBZLU8GN9UDwAnjzUOUgpD0dCRd1SUVLqwM4GpjOeca4XZw==","signatures":[{"sig":"MEUCICNV2sgGv3sZBGII0f2/jWkX9eDTSbo/S8DDS/lVWTjIAiEAobQo7nKb3u19uqFrl3n3XDrSY4+maLaccfsXxWysNDw=","keyid":"SHA256:jl3bwswu80PjjokCgh0o2w5c2U4LhQAE57gj9cz1kzA"}],"unpackedSize":223191},"main":"index.js","_from":"file:n8n-vm2-3.9.19.tgz","types":"index.d.ts","engines":{"node":">=18.10","pnpm":">=8.6.12"},"scripts":{"test":"mocha test","pretest":"eslint ."},"_npmUser":{"name":"netroy","email":"npm@netroy.in"},"_resolved":"/tmp/0f7e701a06d7cd83fa642a6d493afbc2/n8n-vm2-3.9.19.tgz","_integrity":"sha512-KmrkVqri7VG+GQ2JbJ2/2gyEmVkysxzoJUF+zdtqBZLU8GN9UDwAnjzUOUgpD0dCRd1SUVLqwM4GpjOeca4XZw==","repository":{"url":"git+https://github.com/n8n-io/vm2.git","type":"git"},"_npmVersion":"9.8.1","description":"vm2 is a sandbox that can run untrusted code with whitelisted Node's built-in modules. Securely!","directories":{},"sideEffects":false,"_nodeVersion":"18.16.0","dependencies":{"acorn":"^8.7.0","acorn-walk":"^8.2.0"},"_hasShrinkwrap":false,"packageManager":"pnpm@8.6.12","devDependencies":{"mocha":"^6.2.2","eslint":"^5.16.0","eslint-config-integromat":"^1.5.0"},"_npmOperationalInternal":{"tmp":"tmp/vm2_3.9.19_1692729622337_0.9373953400126638","host":"s3://npm-registry-packages"}},"3.9.20":{"name":"@n8n/vm2","version":"3.9.20","keywords":["sandbox","prison","jail","vm","alcatraz","contextify"],"license":"MIT","_id":"@n8n/vm2@3.9.20","maintainers":[{"name":"ivov.src","email":"ivov.src@gmail.com"},{"name":"milorad.filipovic","email":"milorad.filipovic19@gmail.com"},{"name":"netroy","email":"npm@netroy.in"},{"name":"jan_n8n_io","email":"jan@n8n.io"}],"homepage":"https://github.com/n8n-io/vm2#readme","bugs":{"url":"https://github.com/n8n-io/vm2/issues"},"bin":{"vm2":"bin/vm2"},"dist":{"shasum":"161a30aa3a655ff65ed061b1ab41d4dc1724a8ca","tarball":"https://registry.npmjs.org/@n8n/vm2/-/vm2-3.9.20.tgz","fileCount":24,"integrity":"sha512-qk2oJYkuFRVSTxoro4obX/sv/wT1pViZjHh/isjOvFB93D52QIg3TCjMPsHOfHTmkxCKJffjLrUvjIwvWzSMCQ==","signatures":[{"sig":"MEYCIQC1NxpJUaThNe20BXBLpiHfdYIzDxiowuRMEMEu+St3WwIhAKrb55PwKIXO0LBxnUyJaHb3hLoacZXwYJ3vw8NjUsvq","keyid":"SHA256:jl3bwswu80PjjokCgh0o2w5c2U4LhQAE57gj9cz1kzA"}],"unpackedSize":223476},"main":"index.js","_from":"file:n8n-vm2-3.9.20.tgz","types":"index.d.ts","engines":{"node":">=18.10","pnpm":">=8.6.12"},"scripts":{"test":"mocha test","pretest":"eslint ."},"_npmUser":{"name":"netroy","email":"npm@netroy.in"},"_resolved":"/tmp/e2af437e2578b8cb9fb5814132444ce2/n8n-vm2-3.9.20.tgz","_integrity":"sha512-qk2oJYkuFRVSTxoro4obX/sv/wT1pViZjHh/isjOvFB93D52QIg3TCjMPsHOfHTmkxCKJffjLrUvjIwvWzSMCQ==","repository":{"url":"git+https://github.com/n8n-io/vm2.git","type":"git"},"_npmVersion":"9.8.1","description":"vm2 is a sandbox that can run untrusted code with whitelisted Node's built-in modules. Securely!","directories":{},"sideEffects":false,"_nodeVersion":"18.17.1","dependencies":{"acorn":"^8.7.0","acorn-walk":"^8.2.0"},"_hasShrinkwrap":false,"packageManager":"pnpm@8.6.12","devDependencies":{"mocha":"^6.2.2","eslint":"^5.16.0","eslint-config-integromat":"^1.5.0"},"_npmOperationalInternal":{"tmp":"tmp/vm2_3.9.20_1694086095351_0.11368403820262052","host":"s3://npm-registry-packages"}},"3.9.21":{"name":"@n8n/vm2","version":"3.9.21","keywords":["sandbox","prison","jail","vm","alcatraz","contextify"],"license":"MIT","_id":"@n8n/vm2@3.9.21","maintainers":[{"name":"alexgrozav","email":"alex@grozav.com"},{"name":"ivov.src","email":"ivov.src@gmail.com"},{"name":"milorad.filipovic","email":"milorad.filipovic19@gmail.com"},{"name":"netroy","email":"npm@netroy.in"},{"name":"jan_n8n_io","email":"jan@n8n.io"}],"homepage":"https://github.com/n8n-io/vm2#readme","bugs":{"url":"https://github.com/n8n-io/vm2/issues"},"bin":{"vm2":"bin/vm2"},"dist":{"shasum":"b7c8d0574b2ec186eaeb08564609ce6a9418305d","tarball":"https://registry.npmjs.org/@n8n/vm2/-/vm2-3.9.21.tgz","fileCount":24,"integrity":"sha512-KVuHA3CyGKuTLlrTY/BoT3+80qkBkPD7ZJVoLzeUkXcpzd58niFRVwwNzvfIDJE8e824TFtS5MYUX9d9aPILkA==","signatures":[{"sig":"MEUCID43eM87pOoZp/XDV0C9+enZq1diDUjDTrqc12UJOr+ZAiEAsrhr+y+W2XL3aaAVA4mvlg3aWlsYd/gAIQH8ZKOxGRI=","keyid":"SHA256:jl3bwswu80PjjokCgh0o2w5c2U4LhQAE57gj9cz1kzA"}],"unpackedSize":223486},"main":"index.js","types":"index.d.ts","engines":{"node":">=18.10","pnpm":">=8.6.12"},"gitHead":"3ed0b62def11e7748c321f9c0b6318a06d507fdc","scripts":{"test":"mocha test","pretest":"eslint ."},"_npmUser":{"name":"netroy","email":"npm@netroy.in"},"repository":{"url":"git+https://github.com/n8n-io/vm2.git","type":"git"},"_npmVersion":"10.1.0","description":"vm2 is a sandbox that can run untrusted code with whitelisted Node's built-in modules. Securely!","directories":{},"sideEffects":false,"_nodeVersion":"18.18.0","dependencies":{"acorn":"^8.7.0","acorn-walk":"^8.2.0"},"_hasShrinkwrap":false,"packageManager":"pnpm@8.6.12","devDependencies":{"mocha":"^6.2.2","eslint":"^5.16.0","eslint-config-integromat":"^1.5.0"},"_npmOperationalInternal":{"tmp":"tmp/vm2_3.9.21_1696582739824_0.5007882462291842","host":"s3://npm-registry-packages"}},"3.9.22":{"name":"@n8n/vm2","version":"3.9.22","keywords":["sandbox","prison","jail","vm","alcatraz","contextify"],"license":"MIT","_id":"@n8n/vm2@3.9.22","maintainers":[{"name":"alexgrozav","email":"alex@grozav.com"},{"name":"ivov.src","email":"ivov.src@gmail.com"},{"name":"milorad.filipovic","email":"milorad.filipovic19@gmail.com"},{"name":"netroy","email":"npm@netroy.in"},{"name":"jan_n8n_io","email":"jan@n8n.io"}],"homepage":"https://github.com/n8n-io/vm2#readme","bugs":{"url":"https://github.com/n8n-io/vm2/issues"},"bin":{"vm2":"bin/vm2"},"dist":{"shasum":"9c6c66c52c7dfd0e84800ecd921c6ba554a30cf2","tarball":"https://registry.npmjs.org/@n8n/vm2/-/vm2-3.9.22.tgz","fileCount":24,"integrity":"sha512-353SDllYTXtIYT8hEOJJ9UoK2Eu28nBCKcznaf2uTFi54ykNCZ1RvSWp/gC/uH3Gl5xpEGcThWlPfRPlxczL6A==","signatures":[{"sig":"MEYCIQCsLfmKr8dlyYlEUlyJ10VUie8Ewsk1AWjZMi/sADzyvAIhANpIpyZuSSb2u5ea5cB2yjKKacZm5wxabPY3srHIAUAT","keyid":"SHA256:jl3bwswu80PjjokCgh0o2w5c2U4LhQAE57gj9cz1kzA"}],"unpackedSize":223514},"main":"index.js","types":"index.d.ts","engines":{"node":">=18.10","pnpm":">=8.6.12"},"gitHead":"387af40dd4c67a4665f55988a33eb62441cc6019","scripts":{"test":"mocha test","pretest":"eslint ."},"_npmUser":{"name":"netroy","email":"npm@netroy.in"},"repository":{"url":"git+https://github.com/n8n-io/vm2.git","type":"git"},"_npmVersion":"10.1.0","description":"vm2 is a sandbox that can run untrusted code with whitelisted Node's built-in modules. Securely!","directories":{},"sideEffects":false,"_nodeVersion":"18.18.0","dependencies":{"acorn":"^8.7.0","acorn-walk":"^8.2.0"},"_hasShrinkwrap":false,"packageManager":"pnpm@8.6.12","devDependencies":{"mocha":"^6.2.2","eslint":"^5.16.0","eslint-config-integromat":"^1.5.0"},"_npmOperationalInternal":{"tmp":"tmp/vm2_3.9.22_1696584495539_0.5919271708319178","host":"s3://npm-registry-packages"}},"3.9.23":{"name":"@n8n/vm2","version":"3.9.23","keywords":["sandbox","prison","jail","vm","alcatraz","contextify"],"license":"MIT","_id":"@n8n/vm2@3.9.23","maintainers":[{"name":"alexgrozav","email":"alex@grozav.com"},{"name":"ivov.src","email":"ivov.src@gmail.com"},{"name":"milorad.filipovic","email":"milorad.filipovic19@gmail.com"},{"name":"netroy","email":"npm@netroy.in"},{"name":"jan_n8n_io","email":"jan@n8n.io"}],"homepage":"https://github.com/n8n-io/vm2#readme","bugs":{"url":"https://github.com/n8n-io/vm2/issues"},"bin":{"vm2":"bin/vm2"},"dist":{"shasum":"45c0ba660bc629df984846522c587ba736d00b75","tarball":"https://registry.npmjs.org/@n8n/vm2/-/vm2-3.9.23.tgz","fileCount":24,"integrity":"sha512-yu+It+L89uljQsCJ2e9cQaXzoXJe9bU69QQIoWUOcUw0u5Zon37DuB7bdNNsjKS1ZdFD+fBWCQpq/FkqHsSjXQ==","signatures":[{"sig":"MEUCIDjt09c1B7sRF9VNu9fw8ignC3zDr/8lZuhIZ/KfAl/lAiEAtdkmTtGGtk3Rfndqpa05kuOlFSOFo4+VcNewiZjII4c=","keyid":"SHA256:jl3bwswu80PjjokCgh0o2w5c2U4LhQAE57gj9cz1kzA"}],"unpackedSize":223416},"main":"index.js","types":"index.d.ts","engines":{"node":">=18.10","pnpm":">=8.6.12"},"gitHead":"0786f55b4c189c54c24cc3da0b6fdc82ccb92405","scripts":{"test":"mocha test","pretest":"eslint ."},"_npmUser":{"name":"netroy","email":"npm@netroy.in"},"repository":{"url":"git+https://github.com/n8n-io/vm2.git","type":"git"},"_npmVersion":"10.1.0","description":"vm2 is a sandbox that can run untrusted code with whitelisted Node's built-in modules. Securely!","directories":{},"sideEffects":false,"_nodeVersion":"18.18.0","dependencies":{"acorn":"^8.7.0","acorn-walk":"^8.2.0"},"_hasShrinkwrap":false,"packageManager":"pnpm@8.6.12","devDependencies":{"mocha":"^6.2.2","eslint":"^5.16.0","eslint-config-integromat":"^1.5.0"},"_npmOperationalInternal":{"tmp":"tmp/vm2_3.9.23_1696587059129_0.6712422084980982","host":"s3://npm-registry-packages"}},"3.9.24":{"name":"@n8n/vm2","version":"3.9.24","keywords":["sandbox","prison","jail","vm","alcatraz","contextify"],"license":"MIT","_id":"@n8n/vm2@3.9.24","maintainers":[{"name":"alexgrozav","email":"alex@grozav.com"},{"name":"ivov.src","email":"ivov.src@gmail.com"},{"name":"milorad.filipovic","email":"milorad.filipovic19@gmail.com"},{"name":"netroy","email":"npm@netroy.in"},{"name":"jan_n8n_io","email":"jan@n8n.io"}],"homepage":"https://github.com/n8n-io/vm2#readme","bugs":{"url":"https://github.com/n8n-io/vm2/issues"},"bin":{"vm2":"bin/vm2"},"dist":{"shasum":"f20666f79cbeafe1e4d48b8d7ef2cd99790df7e3","tarball":"https://registry.npmjs.org/@n8n/vm2/-/vm2-3.9.24.tgz","fileCount":24,"integrity":"sha512-O4z67yVgUs2FHkcw3vbGnxdC1EglpzOj966kPkK4gtW+ZmTTFRfEB+2Ehq6PMthgg/Ou5JCLSR3wvQIZFFt4Pg==","signatures":[{"sig":"MEUCIQDtDrXhY+o39TKX3tc7tV/NrHWcTwcIjTLsfQK+EOToxQIgBNHsQfZ3cSMyEIp8BXShVliAEb5ahuPFy/sUdjBk9jA=","keyid":"SHA256:jl3bwswu80PjjokCgh0o2w5c2U4LhQAE57gj9cz1kzA"}],"unpackedSize":224300},"main":"index.js","_from":"file:n8n-vm2-3.9.24.tgz","types":"index.d.ts","engines":{"node":">=18.10","pnpm":">=9.6"},"scripts":{"test":"mocha test","pretest":"eslint ."},"_npmUser":{"name":"netroy","email":"npm@netroy.in"},"_resolved":"/tmp/11d00cebb1ff9552750b2739cb58580b/n8n-vm2-3.9.24.tgz","_integrity":"sha512-O4z67yVgUs2FHkcw3vbGnxdC1EglpzOj966kPkK4gtW+ZmTTFRfEB+2Ehq6PMthgg/Ou5JCLSR3wvQIZFFt4Pg==","repository":{"url":"git+https://github.com/n8n-io/vm2.git","type":"git"},"_npmVersion":"10.8.2","description":"vm2 is a sandbox that can run untrusted code with whitelisted Node's built-in modules. Securely!","directories":{},"sideEffects":false,"_nodeVersion":"20.15.1","dependencies":{"acorn":"^8.7.0","acorn-walk":"^8.2.0"},"_hasShrinkwrap":false,"devDependencies":{"mocha":"^6.2.2","eslint":"^5.16.0","eslint-config-integromat":"^1.5.0"},"_npmOperationalInternal":{"tmp":"tmp/vm2_3.9.24_1722427884904_0.6031685954159001","host":"s3://npm-registry-packages"}},"3.9.25":{"name":"@n8n/vm2","version":"3.9.25","keywords":["sandbox","prison","jail","vm","alcatraz","contextify"],"license":"MIT","_id":"@n8n/vm2@3.9.25","maintainers":[{"name":"alexgrozav","email":"alex@grozav.com"},{"name":"ivov.src","email":"ivov.src@gmail.com"},{"name":"milorad.filipovic","email":"milorad.filipovic19@gmail.com"},{"name":"netroy","email":"npm@netroy.in"},{"name":"jan_n8n_io","email":"jan@n8n.io"}],"homepage":"https://github.com/n8n-io/vm2#readme","bugs":{"url":"https://github.com/n8n-io/vm2/issues"},"bin":{"vm2":"bin/vm2"},"dist":{"shasum":"8419c1991c2bb93bea46b69f91007e1f8375d8c4","tarball":"https://registry.npmjs.org/@n8n/vm2/-/vm2-3.9.25.tgz","fileCount":24,"integrity":"sha512-qoGLFzyHBW7HKpwXkl05QKsIh3GkDw6lOiTOWYlUDnOIQ1b7EgM+O5EMjrMGy7r+kz52+Q7o6GLxBIcxVI8rEg==","signatures":[{"sig":"MEUCIQCK32CrIokWXDizmglKxYkpU8dfVclIwNXij1laqNQD1QIgD+VM4R5UmSVHKjjR+ZYaR9xZpop1a9KRYBEcVa9PKjM=","keyid":"SHA256:jl3bwswu80PjjokCgh0o2w5c2U4LhQAE57gj9cz1kzA"}],"unpackedSize":224330},"main":"index.js","_from":"file:n8n-vm2-3.9.25.tgz","types":"index.d.ts","engines":{"node":">=18.10","pnpm":">=9.6"},"scripts":{"test":"mocha test","pretest":"eslint ."},"_npmUser":{"name":"netroy","email":"npm@netroy.in"},"_resolved":"/tmp/82b53551aadc2e6139c87d26f2ec3406/n8n-vm2-3.9.25.tgz","_integrity":"sha512-qoGLFzyHBW7HKpwXkl05QKsIh3GkDw6lOiTOWYlUDnOIQ1b7EgM+O5EMjrMGy7r+kz52+Q7o6GLxBIcxVI8rEg==","repository":{"url":"git+https://github.com/n8n-io/vm2.git","type":"git"},"_npmVersion":"10.8.2","description":"vm2 is a sandbox that can run untrusted code with whitelisted Node's built-in modules. Securely!","directories":{},"sideEffects":false,"_nodeVersion":"20.16.0","dependencies":{"acorn":"^8.7.0","acorn-walk":"^8.2.0"},"_hasShrinkwrap":false,"devDependencies":{"mocha":"^6.2.2","eslint":"^5.16.0","eslint-config-integromat":"^1.5.0"},"_npmOperationalInternal":{"tmp":"tmp/vm2_3.9.25_1722860694052_0.23199082175060304","host":"s3://npm-registry-packages"}}},"time":{"created":"2023-08-22T18:40:22.214Z","modified":"2025-07-29T10:56:12.888Z","3.9.19":"2023-08-22T18:40:22.592Z","3.9.20":"2023-09-07T11:28:15.524Z","3.9.21":"2023-10-06T08:59:00.137Z","3.9.22":"2023-10-06T09:28:15.787Z","3.9.23":"2023-10-06T10:10:59.398Z","3.9.24":"2024-07-31T12:11:25.085Z","3.9.25":"2024-08-05T12:24:54.239Z"},"bugs":{"url":"https://github.com/n8n-io/vm2/issues"},"license":"MIT","homepage":"https://github.com/n8n-io/vm2#readme","keywords":["sandbox","prison","jail","vm","alcatraz","contextify"],"repository":{"url":"git+https://github.com/n8n-io/vm2.git","type":"git"},"description":"vm2 is a sandbox that can run untrusted code with whitelisted Node's built-in modules. Securely!","maintainers":[{"email":"alex@grozav.com","name":"alexgrozav"},{"email":"milorad.filipovic19@gmail.com","name":"milorad.filipovic"},{"email":"ivov.src@gmail.com","name":"ivov.src"},{"email":"jan@n8n.io","name":"jan_n8n_io"},{"email":"cornelius.suermann+npm@gmail.com","name":"cornelius.suermann"},{"email":"jp@n8n.io","name":"jp-at-n8n"}],"readme":"# vm2 [![NPM Version][npm-image]][npm-url] [![NPM Downloads][downloads-image]][downloads-url] [![Package Quality][quality-image]][quality-url] [![Node.js CI](https://github.com/n8n-io/vm2/actions/workflows/node-test.yml/badge.svg)](https://github.com/n8n-io/vm2/actions/workflows/node-test.yml) [![Known Vulnerabilities][snyk-image]][snyk-url]\n\n## ‼️ Project Discontinued ‼️\n\n**TL;DR The library contains critical security issues and should not be used for production! The maintenance of the project has been discontinued. Consider migrating your code to [isolated-vm](https://www.npmjs.com/package/isolated-vm).**\n\nDear community,\n\nIt's been a truly remarkable journey for me since the vm2 project started nine years ago. The original intent was to devise a method for running untrusted code in Node, with a keen focus on maintaining in-process performance. Proxies, an emerging feature in JavaScript at that time, became our tool of choice for this task.\n\nFrom the get-go, we recognized the arduous task that lay ahead, as we tried to safeguard against the myriad of escape scenarios JavaScript presented. However, the thrill of the chase kept us going, hopeful that we could overcome these hurdles.\n\nThrough the years, this project has seen numerous contributions from passionate individuals. I wish to extend my deepest gratitude to all of you. Special thanks go to @XmiliaH, whose unwavering dedication in maintaining and improving this library over the last 4 years was instrumental to its sustained relevance.\n\nUnfortunately, the growing complexity of Node has brought us to a crossroads. We now find ourselves facing an escape so complicated that fixing it seems impossible. And this isn't about one isolated issue. Recent reports have highlighted that sustaining this project in its current form is not viable in the long term.\n\nTherefore, we must announce the discontinuation of this project.\n\nYou may wonder, \"What now?\"\n\nWhile this may seem like an end, I see it as an opportunity for you to transition your projects and adapt to a new solution. We would recommend migrating your code to the [isolated-vm](https://www.npmjs.com/package/isolated-vm), a library which employs a slightly different, yet equally effective, approach to sandboxing untrusted code.\n\nThank you all for your support and understanding during this journey.\n\nWarm Regards,\nPatrik Simek\n\n---\n\n<details>\n<summary>The original Readme is available here.</summary>\n\nvm2 is a sandbox that can run untrusted code with whitelisted Node's built-in modules. ~~Securely!~~\n\n## Features\n\n* Runs untrusted code securely in a single process with your code side by side\n* Full control over the sandbox's console output\n* The sandbox has limited access to the process's methods\n* It is possible to require modules (built-in and external) from the sandbox\n* You can limit access to certain (or all) built-in modules\n* You can securely call methods and exchange data and callbacks between sandboxes\n* Is immune to all known methods of attacks\n* Transpiler support\n\n## How does it work\n\n* It uses the internal VM module to create a secure context.\n* It uses [Proxies](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Proxy) to prevent escaping from the sandbox.\n* It overrides the built-in require to control access to modules.\n\n## What is the difference between Node's vm and vm2?\n\nTry it yourself:\n\n```js\nconst vm = require('vm');\nvm.runInNewContext('this.constructor.constructor(\"return process\")().exit()');\nconsole.log('Never gets executed.');\n```\n\n```js\nconst {VM} = require('vm2');\nnew VM().run('this.constructor.constructor(\"return process\")().exit()');\n// Throws ReferenceError: process is not defined\n```\n\n## Installation\n\n**IMPORTANT**: VM2 requires Node.js 6 or newer.\n\n```sh\nnpm install vm2\n```\n\n## Quick Example\n\n```js\nconst {VM} = require('vm2');\nconst vm = new VM();\n\nvm.run(`process.exit()`); // TypeError: process.exit is not a function\n```\n\n```js\nconst {NodeVM} = require('vm2');\nconst vm = new NodeVM({\n    require: {\n        external: true,\n        root: './'\n    }\n});\n\nvm.run(`\n    var request = require('request');\n    request('http://www.google.com', function (error, response, body) {\n        console.error(error);\n        if (!error && response.statusCode == 200) {\n            console.log(body); // Show the HTML for the Google homepage.\n        }\n    });\n`, 'vm.js');\n```\n\n## Documentation\n\n* [VM](#vm)\n* [NodeVM](#nodevm)\n* [VMScript](#vmscript)\n* [Error handling](#error-handling)\n* [Debugging a sandboxed code](#debugging-a-sandboxed-code)\n* [Read-only objects](#read-only-objects-experimental)\n* [Protected objects](#protected-objects-experimental)\n* [Cross-sandbox relationships](#cross-sandbox-relationships)\n* [CLI](#cli)\n* [2.x to 3.x changes](https://github.com/patriksimek/vm2/wiki/2.x-to-3.x-changes)\n* [1.x and 2.x docs](https://github.com/patriksimek/vm2/wiki/1.x-and-2.x-docs)\n* [Contributing](https://github.com/patriksimek/vm2/wiki/Contributing)\n\n## VM\n\nVM is a simple sandbox to synchronously run untrusted code without the `require` feature. Only JavaScript built-in objects and Node's `Buffer` are available. Scheduling functions (`setInterval`, `setTimeout` and `setImmediate`) are not available by default.\n\n**Options:**\n\n* `timeout` - Script timeout in milliseconds. **WARNING**: You might want to use this option together with `allowAsync=false`. Further, operating on returned objects from the sandbox can run arbitrary code and circumvent the timeout. One should test if the returned object is a primitive with `typeof` and fully discard it (doing logging or creating error messages with such an object might also run arbitrary code again) in the other case.\n* `sandbox` - VM's global object.\n* `compiler` - `javascript` (default) or `coffeescript` or custom compiler function. The library expects you to have coffee-script pre-installed if the compiler is set to `coffeescript`.\n* `eval` - If set to `false` any calls to `eval` or function constructors (`Function`, `GeneratorFunction`, etc.) will throw an `EvalError` (default: `true`).\n* `wasm` -  If set to `false` any attempt to compile a WebAssembly module will throw a `WebAssembly.CompileError` (default: `true`).\n* `allowAsync` - If set to `false` any attempt to run code using `async` will throw a `VMError` (default: `true`).\n\n**IMPORTANT**: Timeout is only effective on synchronous code that you run through `run`. Timeout does **NOT** work on any method returned by VM. There are some situations when timeout doesn't work - see [#244](https://github.com/patriksimek/vm2/pull/244).\n\n```js\nconst {VM} = require('vm2');\n\nconst vm = new VM({\n    timeout: 1000,\n    allowAsync: false,\n    sandbox: {}\n});\n\nvm.run('process.exit()'); // throws ReferenceError: process is not defined\n```\n\nYou can also retrieve values from VM.\n\n```js\nlet number = vm.run('1337'); // returns 1337\n```\n\n**TIP**: See tests for more usage examples.\n\n## NodeVM\n\nUnlike `VM`, `NodeVM` allows you to require modules in the same way that you would in the regular Node's context.\n\n**Options:**\n\n* `console` - `inherit` to enable console, `redirect` to redirect to events, `off` to disable console (default: `inherit`).\n* `sandbox` - VM's global object.\n* `compiler` - `javascript` (default) or `coffeescript` or custom compiler function (which receives the code, and it's file path). The library expects you to have coffee-script pre-installed if the compiler is set to `coffeescript`.\n* `eval` - If set to `false` any calls to `eval` or function constructors (`Function`, `GeneratorFunction`, etc.) will throw an `EvalError` (default: `true`).\n* `wasm` -  If set to `false` any attempt to compile a WebAssembly module will throw a `WebAssembly.CompileError` (default: `true`).\n* `sourceExtensions` - Array of file extensions to treat as source code (default: `['js']`).\n* `require` - `true`, an object or a Resolver to enable `require` method (default: `false`).\n* `require.external` - Values can be `true`, an array of allowed external modules, or an object (default: `false`). All paths matching `/node_modules/${any_allowed_external_module}/(?!/node_modules/)` are allowed to be required.\n* `require.external.modules` - Array of allowed external modules. Also supports wildcards, so specifying `['@scope/*-ver-??]`, for instance, will allow using all modules having a name of the form `@scope/something-ver-aa`, `@scope/other-ver-11`, etc. The `*` wildcard does not match path separators.\n* `require.external.transitive` - Boolean which indicates if transitive dependencies of external modules are allowed (default: `false`). **WARNING**: When a module is required transitively, any module is then able to require it normally, even if this was not possible before it was loaded.\n* `require.builtin` - Array of allowed built-in modules, accepts [\"\\*\"] for all (default: none). **WARNING**: \"\\*\" can be dangerous as new built-ins can be added.\n* `require.root` - Restricted path(s) where local modules can be required (default: every path).\n* `require.mock` - Collection of mock modules (both external or built-in).\n* `require.context` - `host` (default) to require modules in the host and proxy them into the sandbox. `sandbox` to load, compile, and require modules in the sandbox. `callback(moduleFilename, ext)` to dynamically choose a context per module. The default will be sandbox is nothing is specified. Except for `events`, built-in modules are always required in the host and proxied into the sandbox.\n* `require.import` - An array of modules to be loaded into NodeVM on start.\n* `require.resolve` - An additional lookup function in case a module wasn't found in one of the traditional node lookup paths.\n* `require.customRequire` - Use instead of the `require` function to load modules from the host.\n* `require.strict` - `false` to not force strict mode on modules loaded by require (default: `true`).\n* `require.fs` - Custom file system implementation.\n* `nesting` - **WARNING**: Allowing this is a security risk as scripts can create a NodeVM which can require any host module. `true` to enable VMs nesting (default: `false`).\n* `wrapper` - `commonjs` (default) to wrap script into CommonJS wrapper, `none` to retrieve value returned by the script.\n* `argv` - Array to be passed to `process.argv`.\n* `env` - Object to be passed to `process.env`.\n* `strict` - `true` to loaded modules in strict mode (default: `false`).\n\n**IMPORTANT**: Timeout is not effective for NodeVM so it is not immune to `while (true) {}` or similar evil.\n\n**REMEMBER**: The more modules you allow, the more fragile your sandbox becomes.\n\n```js\nconst {NodeVM} = require('vm2');\n\nconst vm = new NodeVM({\n    console: 'inherit',\n    sandbox: {},\n    require: {\n        external: true,\n        builtin: ['fs', 'path'],\n        root: './',\n        mock: {\n            fs: {\n                readFileSync: () => 'Nice try!'\n            }\n        }\n    }\n});\n\n// Sync\n\nlet functionInSandbox = vm.run('module.exports = function(who) { console.log(\"hello \"+ who); }');\nfunctionInSandbox('world');\n\n// Async\n\nlet functionWithCallbackInSandbox = vm.run('module.exports = function(who, callback) { callback(\"hello \"+ who); }');\nfunctionWithCallbackInSandbox('world', (greeting) => {\n    console.log(greeting);\n});\n```\n\nWhen `wrapper` is set to `none`, `NodeVM` behaves more like `VM` for synchronous code.\n\n```js\nassert.ok(vm.run('return true') === true);\n```\n\n**TIP**: See tests for more usage examples.\n\n### Loading modules by relative path\n\nTo load modules by relative path, you must pass the full path of the script you're running as a second argument to vm's `run` method if the script is a string. The filename is then displayed in any stack traces generated by the script.\n\n```js\nvm.run('require(\"foobar\")', '/data/myvmscript.js');\n```\n\nIf the script you are running is a VMScript, the path is given in the VMScript constructor.\n\n```js\nconst script = new VMScript('require(\"foobar\")', {filename: '/data/myvmscript.js'});\nvm.run(script);\n```\n\n### Resolver\n\nA resolver can be created via `makeResolverFromLegacyOptions` and be used for multiple `NodeVM` instances allowing to share compiled module code potentially speeding up load times. The first example of `NodeVM` can be rewritten using `makeResolverFromLegacyOptions` as follows.\n\n```js\nconst resolver = makeResolverFromLegacyOptions({\n    external: true,\n    builtin: ['fs', 'path'],\n    root: './',\n    mock: {\n        fs: {\n            readFileSync: () => 'Nice try!'\n        }\n    }\n});\nconst vm = new NodeVM({\n    console: 'inherit',\n    sandbox: {},\n    require: resolver\n});\n```\n\n## VMScript\n\nYou can increase performance by using precompiled scripts. The precompiled VMScript can be run multiple times. It is important to note that the code is not bound to any VM (context); rather, it is bound before each run, just for that run.\n\n```js\nconst {VM, VMScript} = require('vm2');\n\nconst vm = new VM();\nconst script = new VMScript('Math.random()');\nconsole.log(vm.run(script));\nconsole.log(vm.run(script));\n```\n\nIt works for both `VM` and `NodeVM`.\n\n```js\nconst {NodeVM, VMScript} = require('vm2');\n\nconst vm = new NodeVM();\nconst script = new VMScript('module.exports = Math.random()');\nconsole.log(vm.run(script));\nconsole.log(vm.run(script));\n```\n\nCode is compiled automatically the first time it runs. One can compile the code anytime with `script.compile()`. Once the code is compiled, the method has no effect.\n\n## Error handling\n\nErrors in code compilation and synchronous code execution can be handled by `try-catch`. Errors in asynchronous code execution can be handled by attaching `uncaughtException` event handler to Node's `process`.\n\n```js\ntry {\n    var script = new VMScript('Math.random()').compile();\n} catch (err) {\n    console.error('Failed to compile script.', err);\n}\n\ntry {\n    vm.run(script);\n} catch (err) {\n    console.error('Failed to execute script.', err);\n}\n\nprocess.on('uncaughtException', (err) => {\n    console.error('Asynchronous error caught.', err);\n});\n```\n\n## Debugging a sandboxed code\n\nYou can debug or inspect code running in the sandbox as if it was running in a normal process.\n\n* You can use breakpoints (which requires you to specify a script file name)\n* You can use `debugger` keyword.\n* You can use step-in to step inside the code running in the sandbox.\n\n### Example\n\n/tmp/main.js:\n\n```js\nconst {VM, VMScript} = require('.');\nconst fs = require('fs');\nconst file = `${__dirname}/sandbox.js`;\n\n// By providing a file name as second argument you enable breakpoints\nconst script = new VMScript(fs.readFileSync(file), file);\n\nnew VM().run(script);\n```\n\n/tmp/sandbox.js\n\n```js\nconst foo = 'ahoj';\n\n// The debugger keyword works just fine everywhere.\n// Even without specifying a file name to the VMScript object.\ndebugger;\n```\n\n## Read-only objects (experimental)\n\nTo prevent sandboxed scripts from adding, changing, or deleting properties from the proxied objects, you can use `freeze` methods to make the object read-only. This is only effective inside VM. Frozen objects are affected deeply. Primitive types cannot be frozen.\n\n**Example without using `freeze`:**\n\n```js\nconst util = {\n    add: (a, b) => a + b\n}\n\nconst vm = new VM({\n    sandbox: {util}\n});\n\nvm.run('util.add = (a, b) => a - b');\nconsole.log(util.add(1, 1)); // returns 0\n```\n\n**Example with using `freeze`:**\n\n```js\nconst vm = new VM(); // Objects specified in the sandbox cannot be frozen.\nvm.freeze(util, 'util'); // Second argument adds object to global.\n\nvm.run('util.add = (a, b) => a - b'); // Fails silently when not in strict mode.\nconsole.log(util.add(1, 1)); // returns 2\n```\n\n**IMPORTANT:** It is not possible to freeze objects that have already been proxied to the VM.\n\n## Protected objects (experimental)\n\nUnlike `freeze`, this method allows sandboxed scripts to add, change, or delete properties on objects, with one exception - it is not possible to attach functions. Sandboxed scripts are therefore not able to modify methods like `toJSON`, `toString` or `inspect`.\n\n**IMPORTANT:** It is not possible to protect objects that have already been proxied to the VM.\n\n## Cross-sandbox relationships\n\n```js\nconst assert = require('assert');\nconst {VM} = require('vm2');\n\nconst sandbox = {\n    object: new Object(),\n    func: new Function(),\n    buffer: new Buffer([0x01, 0x05])\n}\n\nconst vm = new VM({sandbox});\n\nassert.ok(vm.run(`object`) === sandbox.object);\nassert.ok(vm.run(`object instanceof Object`));\nassert.ok(vm.run(`object`) instanceof Object);\nassert.ok(vm.run(`object.__proto__ === Object.prototype`));\nassert.ok(vm.run(`object`).__proto__ === Object.prototype);\n\nassert.ok(vm.run(`func`) === sandbox.func);\nassert.ok(vm.run(`func instanceof Function`));\nassert.ok(vm.run(`func`) instanceof Function);\nassert.ok(vm.run(`func.__proto__ === Function.prototype`));\nassert.ok(vm.run(`func`).__proto__ === Function.prototype);\n\nassert.ok(vm.run(`new func() instanceof func`));\nassert.ok(vm.run(`new func()`) instanceof sandbox.func);\nassert.ok(vm.run(`new func().__proto__ === func.prototype`));\nassert.ok(vm.run(`new func()`).__proto__ === sandbox.func.prototype);\n\nassert.ok(vm.run(`buffer`) === sandbox.buffer);\nassert.ok(vm.run(`buffer instanceof Buffer`));\nassert.ok(vm.run(`buffer`) instanceof Buffer);\nassert.ok(vm.run(`buffer.__proto__ === Buffer.prototype`));\nassert.ok(vm.run(`buffer`).__proto__ === Buffer.prototype);\nassert.ok(vm.run(`buffer.slice(0, 1) instanceof Buffer`));\nassert.ok(vm.run(`buffer.slice(0, 1)`) instanceof Buffer);\n```\n\n## CLI\n\nBefore you can use vm2 in the command line, install it globally with `npm install vm2 -g`.\n\n```sh\nvm2 ./script.js\n```\n\n## Known Issues\n\n* **There are known security issues to circumvent the sandbox.**\n* It is not possible to define a class that extends a proxied class. This includes using a proxied class in `Object.create`.\n* Direct eval does not work.\n* Logging sandbox arrays will repeat the array part in the properties.\n* Source code transformations can result a different source string for a function.\n* There are ways to crash the node process from inside the sandbox.\n\n## Deployment\n\n1. Update the `CHANGELOG.md`\n2. Update the `package.json` version number\n3. Commit the changes\n4. Run `npm publish`\n\n## Sponsors\n\n[![Integromat][integromat-image]][integromat-url]\n\n[npm-image]: https://img.shields.io/npm/v/vm2.svg?style=flat-square\n[npm-url]: https://www.npmjs.com/package/vm2\n[downloads-image]: https://img.shields.io/npm/dm/vm2.svg?style=flat-square\n[downloads-url]: https://www.npmjs.com/package/vm2\n[quality-image]: http://npm.packagequality.com/shield/vm2.svg?style=flat-square\n[quality-url]: http://packagequality.com/#?package=vm2\n[travis-image]: https://img.shields.io/travis/patriksimek/vm2/master.svg?style=flat-square&label=unit\n[travis-url]: https://travis-ci.org/patriksimek/vm2\n[snyk-image]: https://snyk.io/test/github/patriksimek/vm2/badge.svg\n[snyk-url]: https://snyk.io/test/github/patriksimek/vm2\n[integromat-image]: https://static.integromat.com/logo/45_text.png\n[integromat-url]: https://www.integromat.com\n\n</details>\n","readmeFilename":"README.md"}